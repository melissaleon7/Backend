/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 13.5 		*/
/*  Created On : 28-may.-2019 20:06:01 				*/
/*  DBMS       : MySql 						*/
/* ---------------------------------------------------- */



CREATE DATABASE china_long;

USE china_long;

SET FOREIGN_KEY_CHECKS=0 
;

/* Create Tables */

CREATE TABLE `Cliente`
(
	`IDCliente` INT NOT NULL AUTO_INCREMENT,
	`Nombre` VARCHAR(30) NOT NULL,
	`ApPat` VARCHAR(60) NOT NULL,
	`ApMat` VARCHAR(60) NOT NULL,
	`Nac` DATE NOT NULL,
	`RFC` VARCHAR(13) NULL,
	`Tel` VARCHAR(12) NULL,
	CONSTRAINT `PK_Cliente` PRIMARY KEY (`IDCliente` ASC)
)

;

CREATE TABLE `ClienteMesa`
(
	`IDMesa1` INT NOT NULL,
	`IDMesa2` INT NULL DEFAULT NULL,
	`IDCliente` INT NOT NULL
)

;

CREATE TABLE `Consumo`
(
	`IDConsumo` INT NOT NULL AUTO_INCREMENT,
	`IDCliente` INT NOT NULL,
	`IDPlatillo` INT NOT NULL,
	`IDEmp` INT NOT NULL,
	`Cantidad` INT NOT NULL,
	`IDMesa1` INT NOT NULL,
	`IDMesa2` INT NULL DEFAULT NULL,
	CONSTRAINT `PK_Consumo` PRIMARY KEY (`IDConsumo` ASC)
)

;

CREATE TABLE `Menu`
(
	`IDPlatillo` INT NOT NULL AUTO_INCREMENT,
	`Nombre` VARCHAR(200) NOT NULL,
	`Descr` VARCHAR(200) NOT NULL,
	`Tipo` CHAR(2) NOT NULL,
	`Precio` DOUBLE(10,2) NOT NULL,
	CONSTRAINT `PK_Table1` PRIMARY KEY (`IDPlatillo` ASC)
)

;

CREATE TABLE `Mesa`
(
	`IDMesa` INT NOT NULL AUTO_INCREMENT,
	`Cantidad` INT NULL,
	CONSTRAINT `PK_Mesa` PRIMARY KEY (`IDMesa` ASC)
)

;

CREATE TABLE `Mesero`
(
	`IDEmp` INT NOT NULL AUTO_INCREMENT,
	`Nombre` VARCHAR(30) NOT NULL,
	`ApPat` VARCHAR(60) NOT NULL,
	`ApMat` VARCHAR(60) NOT NULL,
	`Tel` VARCHAR(12) NOT NULL,
	`Correo` VARCHAR(40) NOT NULL,
	`Dir` VARCHAR(200) NOT NULL,
	`Sueldo` DOUBLE(10,2) NOT NULL,
	`Horario` VARCHAR(15) NOT NULL,
	CONSTRAINT `PK_Mesero` PRIMARY KEY (`IDEmp` ASC)
)

;

CREATE TABLE `MeseroMesa`
(
	`IDEmp` INT NOT NULL,
	`IDMesa` INT NOT NULL
);

CREATE TABLE `Venta`
(
	`IDVenta` INT NOT NULL AUTO_INCREMENT,
	`IDCliente` INT NOT NULL,
	`CantidadTotal` INT NOT NULL,
	`SubTotal` DOUBLE(10,2) NOT NULL,
	`IVA` DOUBLE(10,2) NOT NULL,
	`Total` DOUBLE(10,2) NOT NULL,
	`Fecha` DATE NOT NULL,
	`Hora` TIME NOT NULL,
	CONSTRAINT `PK_Venta` PRIMARY KEY (`IDVenta` ASC)
);




CREATE TABLE CobroParcial(

	`IDVenta` INT NOT NULL,
	`IDMesa` INT NOT NULL,
	`IDCliente` INT NOT NULL,
	`Cantidad` INT NOT NULL,
	`SubTotal` DOUBLE(10,2) NOT NULL,
	`IVA` DOUBLE(10,2) NOT NULL,
	`Total` DOUBLE NOT NULL

);

/* Create Foreign Key Constraints */

ALTER TABLE `ClienteMesa` 
 ADD CONSTRAINT `FK_ClienteMesa_Cliente`
	FOREIGN KEY (`IDCliente`) REFERENCES `Cliente` (`IDCliente`) ON DELETE Cascade ON UPDATE Cascade
;

ALTER TABLE `ClienteMesa` 
 ADD CONSTRAINT `FK_ClienteMesa_Mesa`
	FOREIGN KEY (`IDMesa1`) REFERENCES `Mesa` (`IDMesa`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `ClienteMesa` 
 ADD CONSTRAINT `FK_ClienteMesa_Mesa_02`
	FOREIGN KEY (`IDMesa2`) REFERENCES `Mesa` (`IDMesa`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Consumo` 
 ADD CONSTRAINT `FK_Consumo_Menu`
	FOREIGN KEY (`IDPlatillo`) REFERENCES `Menu` (`IDPlatillo`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Consumo` 
 ADD CONSTRAINT `FK_Consumo_Cliente`
	FOREIGN KEY (`IDCliente`) REFERENCES `Cliente` (`IDCliente`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Consumo` 
 ADD CONSTRAINT `FK_Consumo_Mesero`
	FOREIGN KEY (`IDEmp`) REFERENCES `Mesero` (`IDEmp`) ON DELETE Restrict ON UPDATE Restrict
;


ALTER TABLE `MeseroMesa` 
 ADD CONSTRAINT `FK_MeseroMesa_Mesa`
	FOREIGN KEY (`IDMesa`) REFERENCES `Mesa` (`IDMesa`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `MeseroMesa` 
 ADD CONSTRAINT `FK_MeseroMesa_Mesero`
	FOREIGN KEY (`IDEmp`) REFERENCES `Mesero` (`IDEmp`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Venta` 
 ADD CONSTRAINT `FK_Venta_Cliente`
	FOREIGN KEY (`IDCliente`) REFERENCES `Cliente` (`IDCliente`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `CobroParcial`
 ADD CONSTRAINT `FK_CobroParcial_Venta` 
	FOREIGN KEY (`IDVenta`) REFERENCES `Venta` (`IDVenta`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `CobroParcial`
 ADD CONSTRAINT `FK_CobroParcial_Mesa`
	FOREIGN KEY (`IDMesa`) REFERENCES `Mesa` (`IDMesa`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `CobroParcial`
 ADD CONSTRAINT `FK_CobroParcial_Cliente`
	FOREIGN KEY (`IDCliente`) REFERENCES `Cliente` (`IDCliente`) ON DELETE Restrict ON UPDATE Restrict
;


ALTER TABLE `Consumo`
 ADD CONSTRAINT `FK_Consumo_Mesa1` 
	FOREIGN KEY (`IDMesa1`) REFERENCES `Mesa` (`IDMesa`) ON DELETE Restrict ON UPDATE Restrict
;

ALTER TABLE `Consumo`
 ADD CONSTRAINT `FK_Consumo_Mesa2` 
	FOREIGN KEY (`IDMesa2`) REFERENCES `Mesa` (`IDMesa`) ON DELETE Restrict ON UPDATE Restrict
;
SET FOREIGN_KEY_CHECKS=1 
;
